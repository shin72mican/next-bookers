name: Deploy Bookers

on:
  pull_request:
    branches:
      - main

jobs:
  deploy-backend:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Deploy API App to Vercel
        run: |
          curl -X POST https://api.vercel.com/v1/integrations/deploy/prj_nvOVnRZ3xnHz1TF4t74C4rvGCmQk/l3uC1gPb8Q
      - name: Wait for API App deployment
        run: |
          for i in {1..30}; do \
            response=$(curl --write-out '%{http_code}' --silent --output /dev/null https://your-api-app-url.vercel.app/healthcheck); \
            if [ $response -eq 200 ]; then \
              echo "API is up!"; \
              break; \
            else \
              echo "Waiting for API to be up..."; \
              sleep 10; \
            fi; \
          done
  
  deploy-frontend:
    runs-on: ubuntu-latest
    needs: deploy-backend
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Deploy API App to Vercel
        run: |
          curl -X POST https://api.vercel.com/v1/integrations/deploy/prj_x3MjPleNoYAGGtOiG3r0QJ2zSr22/pR6imlHWE2
          